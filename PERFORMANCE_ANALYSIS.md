# 카트 시스템 성능 분석

## 시나리오별 성능 비교

### 시나리오 1: 같은 상품 찾기 (카트에 10개 아이템)

#### RedisHash 방식
- Redis 호출: 11번 (cartIds 1번 + 각 cart 조회 10번)
- 네트워크 왕복: 11번
- 메모리: 최소 (필요한 데이터만 조회)
- **예상 시간**: ~11ms (네트워크 지연 1ms 가정)

#### JSON 방식
- Redis 호출: 1번
- 네트워크 왕복: 1번
- JSON 파싱: O(n) CPU 시간
- 메모리: 전체 데이터 로드
- **예상 시간**: ~2-3ms (파싱 포함)

**결론**: JSON 방식이 약 3-5배 빠름 (네트워크 호출이 적음)

---

### 시나리오 2: 수량 변경 (카트에 10개 아이템)

#### RedisHash 방식
- Redis 호출: 2번 (cartIds 조회 + quantity 수정)
- 원자성: ✅ 보장 (HSET은 원자적)
- 동시성: ✅ 안전
- **예상 시간**: ~2ms

#### JSON 방식
- Redis 호출: 2번 (조회 + 저장)
- JSON 파싱/직렬화: CPU 시간
- 원자성: ❌ 없음 (전체 덮어쓰기)
- 동시성: ⚠️ 위험 (lost update 가능)
- **예상 시간**: ~3-4ms (파싱/직렬화 포함)

**결론**: RedisHash 방식이 더 안전하고, 성능도 비슷하거나 더 좋음

---

### 시나리오 3: 옵션 변경 (카트에 10개 아이템)

#### RedisHash 방식
- Redis 호출: 2번
- 원자성: ✅ 보장
- **예상 시간**: ~2ms

#### JSON 방식
- Redis 호출: 2번
- JSON 파싱/직렬화: CPU 시간
- 원자성: ❌ 없음
- **예상 시간**: ~3-4ms

**결론**: RedisHash 방식이 더 안전

---

## UX 영향 분석

### 네트워크 지연 가정
- 로컬 Redis: ~0.1-0.5ms
- 원격 Redis: ~1-5ms

### 카트 아이템 수에 따른 영향

| 아이템 수 | RedisHash (ms) | JSON (ms) | 차이 |
|----------|---------------|-----------|------|
| 5개      | ~6ms         | ~2ms      | JSON 3배 빠름 |
| 10개     | ~11ms        | ~3ms      | JSON 3.6배 빠름 |
| 20개     | ~21ms        | ~4ms      | JSON 5배 빠름 |
| 50개     | ~51ms        | ~8ms      | JSON 6배 빠름 |

**하지만**:
- 50ms도 사용자가 체감하기 어려운 수준
- 실제로는 Redis가 매우 빠르므로 더 빠를 수 있음
- UX 문제가 될 정도는 아님

---

## 최종 권장사항

### RedisHash 방식 권장 (현재 구조 유지)
**이유**:
1. ✅ 수량/옵션 변경이 빈번 → 원자적 연산 필요
2. ✅ 동시성 안전성 보장
3. ✅ 개별 필드 수정 효율적
4. ⚠️ 같은 상품 찾기는 약간 느리지만 UX 영향 없음

### 최적화 방안
같은 상품 찾기 성능 개선:
- **인덱스 추가**: `cart:user:{email}:index` → `{storeId}:{productId} -> cartId` 매핑
- **캐싱**: 자주 조회하는 사용자 카트 정보 캐싱
